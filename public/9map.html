<!DOCTYPE html>
<html>
	<head>

		<title>OBJECT MAP</title>
		<link href='http://fonts.googleapis.com/css?family=Inconsolata:400,700' rel='stylesheet' type='text/css'>

	<style>
	
		body {
			background-color: #222;
			cursor: none;
		}
		
		
		#map {
				width: 100%;
				height: 100%;
				position: absolute;
				top: 0px;
				left: 0px;
				float: left;
				display: block;

		}
		
		
		#highlight {
			z-index:1000;
			display: block;
			position: absolute;
			-moz-box-shadow: 0 0 20px 10px white;
			-webkit-box-shadow: 0 0 20px 10px white;
			box-shadow: 0 0 20px 10px white;
		
		}
			
		.img-preview{
			z-index: 200;
			width: 100%;
			height: 100%;
			position: relative;
			text-align: center;
		}	
		.img-preview img{
			position: relative;
			top: 50%;
			transform: translateY(-50%);
			max-height: 100%;
			max-width: 100%;
			webkit-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
			-moz-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
		}		
		.button {
			position: absolute;
			top: 0;
			right: 0;
			z-index: 9999;
			height: 100px;
	
		}
		.button div {
			float: left;
		}
		.button div:nth-of-type(1) {
			background-color: white;
			width: 110px;
			height: 100px;
			color: black;
			line-height: 105px;
			font-size: 120px;
			text-align: center;
		}	
		.button div:nth-of-type(2) {
			color: white;
			font-size: 100px;
			margin: -2px 0 0 10px;
		}		
		.button:hover {
			cursor: pointer;	
					}
		.metadata_back{
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			z-index: 50;
			opacity: .6;
			background: black;
			display: none;
			pointer-events: none;
		}
		.metadata {
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			color: white;
			font-family: 'Inconsolata',sans-serif;
			display: none;
			z-index: 100;
			/*FONT SIZE JSON*/
			font-size: 30px;
			cursor: default;
		}
		
		.metadata .p1,.metadata .p2,.metadata .p3,.metadata .p4,.metadata .p5,.metadata .p6,.metadata .p7,.metadata .p8,.metadata .p9{
			float: left;
			width: 33.33333333333333%;
			height: 33.33333333333333%;
			overflow: hidden;
			position: relative;
			
		}
		
		.p5 {
			/*cursor: pointer;*/
		}	

		.metadata .phldr {
			position:absolute;
			/*PADDING WITHIN EACH SCREEN*/
			top: 40px;
			bottom: 40px;
			left: 40px;
			right: 40px;
		}
		.metadata .tabspace {
			padding-left: 25px;
		}
		.metadata .tabspace2 {
			padding-left: 50px;
		}
		.metadata .p1,.metadata .p9 {
			/*FONT SIZE BRACKETS*/
			font-size: 590px;
			text-align: center;
			font-family: 'Inconsolata',sans-serif;
		}
		
		.searchfield {
			cursor: pointer;
		}
		
		.searchfield:hover {
			background-color: white;
		}

		
		#toggle {
			position: absolute;
			width: 166px;
			height: 100px;
			left: 0px;
			top: 0px;
			z-index: 5000;
			cursor: pointer;
			opacity: 1;
		}
		
		#toggle:hover {
			opacity: 1;
		}	
		
		div.sq {
			display:block;
			float: left;
			position: relative;
			width: 28%;
			height: 100%;
			margin-left: 4px;
			background-color: white;
		}
		.message_hldr{
			pointer-events: none;
			display: none;
			z-index: 9999;
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			opacity: .6;
			background: black;
		}
		.message{
			pointer-events: none;
			position: absolute;
		  	top: 50%;
		  	margin-top: -50px;/* half of #content height*/
		  	left: 0;
		  	width: 100%;
			
		}
		.message div{
			pointer-events: none;
			width: 800px;
			margin-left: auto;
			margin-right: auto;
			height: 70px;
			font-size: 60px;
			text-align: center;
			padding: 50px 0;
			border: 2px solid white;
			color: white;
			font-family: 'Inconsolata',sans-serif;
		}
	</style>
	</head>
	
	<body>
	

		
		
		<div id="highlight"></div>
		<div class="metadata_back"></div>
		<div class='metadata'>
		<!--<span class="p6" id='sort'></span>-->
			<div class="p1">{</div>
			<div class="p2"><div class='phldr'>2</div></div>	
			<!--<span class="p2next">Dated: <span id="date"></span></span>-->
			<div class="p3"><div class='phldr'>3</div></div>
			<div class="p4"><div class='phldr'>4</div></div>
			<div class="p5"><div class='phldr' id="preview">
				
				<div class='img-preview'>
				</div>
				
					<!--- PANELS ICON -->
					<div id="toggle">
						<div class="sq"></div><div class="sq"></div><div class="sq"></div>
					</div>
					<!--- ADD TO TRAY ICON -->
					<div class='button'><div>+</div><div>&#10140;</div></div>
			</div></div>
			<div class="p6"><div class='phldr'>6</div></div>
			<div class="p7"><div class='phldr'>7</div></div>
			<div class="p8"><div class='phldr'>8</div></div>
			<div class="p9">},</div>
		</div>
<div class="message_hldr"><div class="message">
	<div>Added to tray</div>
</div></div>
		<canvas id="map"></canvas>
		<!--
		<div id="preview">
			<img class ='img-preview'>
			<div class='button'>Add to tray</div>
		</div>
		-->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js" ></script>  
	<script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>
	

	
	<script>
		var i = 0;
		var art = {};
		art.records = [];
		var curr = false;
		var host = window.location.host;
		var socket = io();
		var images2 = [];
		var sort = window.location.search.substr(1);
		var grid = true;
		
		var map = document.getElementById('map');
		var ctx = map.getContext('2d');
		var itemX = 0;



$(document).ready(function() {

	map.height = window.innerHeight;
	map.width = window.innerWidth;

	getMoreArt(0);
	$("#preview").css("opacity", 0);

});

$(".button").on("click", function() {
		//$(".swoosh div").css({'color':color});
		var id = curr.objectid;
		socket.emit('add-item', {
			objectid: id
		});
		$(".message_hldr").fadeIn(200).delay(500).fadeOut(200);
});

$(".button").on("mouseover", function() {
	$(".button div:nth-of-type(1)").css("background-color", color);
	$(".button div:nth-of-type(2)").css("color", color);
});

$(".button").on("mouseout", function() {
	$(".button div:nth-of-type(1)").css("background-color", "white");
	$(".button div:nth-of-type(2)").css("color", "white");
});

$("#toggle").on("mouseover", function() {
	$("#toggletext").show();
	$("#toggle .sq").css("background-color", color);
});

$("#toggle").on("mouseout", function() {
	$("#toggle .sq").css("background-color", "white");
});

$("#toggle").on("click", function() {
	window.location.href = window.location.origin+"/9panels.html";
});
	


$(".metadata, .metadata_back").on("click", function(e) {
	if($(e.target).hasClass("searchfield")) {
		sort = $(e.target).html();
		art.records.sort(customSort);
		populateMap();
	} else {
		$(".metadata, .metadata_back").hide();
		$("#highlight").show();
	}
});

$("#map").on("mousemove", function(e) {
	var eX = e.offsetX || e.clientX;
	var eY = e.offsetY || e.clientY;

	eX -= w/2;
	eY -= h/2;
	
	var eX2 = Math.round(eX / w)*w;
	var eY2 = Math.round(eY / h)*h;
	
	$("#highlight").css("top", eY2);
	$("#highlight").css("left", eX2);

});
		
$(document).on("click", function(e) {
	if(e.which == 2) {
		location.reload();

	} else if($(e.target).attr("id") == "map" || $(e.target).attr("id") == "highlight") {
			$.each(art.records, function(i, val) {
				var eX = e.clientX;
				var eY = e.clientY;
				$("#highlight").hide();
			
				if(eX > val.x1 && eX < val.x1+w) {
					if(eY > val.y1 && eY < val.y1+h) {
						curr = val;
					}
				}
			});
	

			$(".metadata, .metadata_back").show();


	

		
			var img_src= "./art/" + curr.objectid + ".jpg";


			var title='',people='',birthplace='',name='',personid='',role='',displayorder='',culture='',displaydate='',deathplace='',displayname='',dated='', accessionyear='';
			var division='',signed='',century='',classification='',description='', provenance='';
			var department='',objectnumber='',contact='',exhibitioncount='',creditline='',copyright='',gallery='';
			var url='',primaryimageurl='',totalpageviews='',totaluniquepageviews='',lastupdate='',dateoffirstpageview='',dateoflastpageview='',images='';
			var id='',verificationlevel='',verificationleveldescription='',imagepermissionlevel='',accesslevel='',mediacount='',groupcount='',markscount='',relatedcount='',imagecount='',peoplecount='',titlescount='',datebegin='',dateend='',contextualtextcount='';
			var colorcount='',worktype='',dimensions='',medium='',colors='',technique='';

			$(".p1").children().remove();
			$(".p2 .phldr").children().remove();
			$(".p3 .phldr").children().remove();
			$(".p4 .phldr").children().remove();
			$(".p6 .phldr").children().remove();
			$(".p7 .phldr").children().remove();
			$(".p8 .phldr").children().remove();
			$(".p9").children().remove();
			$("#preview img").remove();
			
			
			$("#preview .img-preview").append("<img id='artimg' src='"+img_src+"'>");

									
			///p2
			if(curr.title){title = '<span class="searchfield">title</span>: "' + curr.title + '",</br>';};
		
			if(curr.people){
					people = 'people:</br>[</br>'+'<div class="tabspace">';
				for (i = 0; i < curr.people.length; i++) { 
						people += JSON.stringify(curr.people[i])+'",</br>'
				}
					people += '</div>' + '],</br>';
			};						
			if(curr.dated){dated = '<span class="searchfield">dated</span>: "' + curr.dated+',<br />';};
			if(curr.accessionyear){accessionyear = '<span class="searchfield">accessionyear</span>: "' + curr.accessionyear;};

			///p3
			if(curr.division){division = '<span class="searchfield">division</span>: "' + curr.division + '",</br>';};
			if(curr.signed){signed = '<span class="searchfield">signed</span>: "' + curr.signed + '",</br>';};
			if(curr.century){century = '<span class="searchfield">century</span>: "' + curr.century + '",</br>';};
			if(curr.culture){culture = '<span class="searchfield">culture</span>: "' + curr.culture + '",</br>';};
			
			if(curr.classification){classification = '<span class="searchfield">classification</span>: "' + curr.classification + '",</br>';};
			if(curr.description){description = 'description: "' + curr.description+',<br />';};
			if(curr.provenance){provenance = 'provenance: "' + curr.provenance;};

			///p4
			if(curr.department){department = '<span class="searchfield">department</span>: "' + curr.department + '",</br>';};
			if(curr.objectnumber){objectnumber = '<span class="searchfield">objectnumber</span>: "' + curr.objectnumber + '",</br>';};
			if(curr.contact){contact = 'contact: "' + curr.contact + '",</br>';};
			if(curr.exhibitioncount){exhibitioncount = '<span class="searchfield">exhibitioncount</span>: "' + curr.exhibitioncount + '",</br>';};
			if(curr.creditline){creditline = 'creditline: "' + curr.creditline + '",</br>';};
			if(curr.copyright){copyright = 'copyright: "' + curr.copyright + '",</br>';};
			if(curr.gallery){
				gallery='gallery:</br>{</br><div class="tabspace">'+
				JSON.stringify(curr.gallery)+'</br></div>';		
			};

			
			///p6
			if(curr.colorcount){colorcount = '<span class="searchfield">colorcount</span>: "' + curr.colorcount + '",</br>';};
			if(curr.worktypes){
				worktype = 'worktype:</br>[</br>' + '<div class="tabspace">';
				for(i=0; i<curr.worktypes.length; i++) {
					worktype+=JSON.stringify(curr.worktypes[i])+',</br>';
				}
				worktype += '</div>' + '],<br />';
			};
			if(curr.dimensions){dimensions = 'dimensions: "' + curr.dimensions + '",</br>';};
			if(curr.medium){medium = '<span class="searchfield">medium</span>: "' + curr.medium + '",</br>';};
			if(curr.technique){technique = '<span class="searchfield">technique</span>: "' + curr.technique + '",</br>';};

			if(curr.colors){
					colors = 'colors:</br>[</br>' + '<div class="tabspace">';
				for (i = 0; i < curr.colors.length; i++) { 
						colors += JSON.stringify(curr.colors[i])+',</br>'
				}
					colors += '</div>' + '],';
			};

			///p7
			if(curr.url){url = 'url: "' + curr.url + '",</br>';};
			if(curr.primaryimageurl){primaryimageurl = 'primaryimageurl: "' + curr.primaryimageurl + '",</br>';};
			if(curr.totalpageviews){totalpageviews = '<span class="searchfield">totalpageviews</span>: "' + curr.totalpageviews + '",</br>';};
			if(curr.totaluniquepageviews){totaluniquepageviews = '<span class="searchfield">totaluniquepageviews</span>: "' + curr.totaluniquepageviews + '",</br>';};
			if(curr.lastupdate){lastupdate = 'lastupdate: "' + curr.lastupdate + '",</br>';};
			if(curr.dateoffirstpageview){dateoffirstpageview = 'dateoffirstpageview: "' + curr.dateoffirstpageview + '",</br>';};
			if(curr.dateoflastpageview){dateoflastpageview = 'dateoflastpageview: "' + curr.dateoflastpageview + '",</br>';};
			if(curr.images){
					images = 'images:</br>[</br>'+'<div class="tabspace">'+'<div class="tabspace">';
				for (i = 0; i < curr.images.length; i++) { 
						images += JSON.stringify(curr.images[i])+'",</br>'
				}
					images += '</div>' + '</div>' +'],';
			};						

			///p8
			if(curr.id){id = 'id: "' + curr.id + '",</br>';};
			if(curr.verificationlevel){verificationlevel = '<span class="searchfield">verificationlevel</span>: "' + curr.verificationlevel + '",</br>';};
			if(curr.imagepermissionlevel){imagepermissionlevel = '<span class="searchfield">imagepermissionlevel</span>: "' + curr.imagepermissionlevel + '",</br>';};
			if(curr.verificationleveldescription){verificationleveldescription = 'verificationleveldescription: "' + curr.verificationleveldescription + '",</br>';};
	
			if(curr.accesslevel){accesslevel = '<span class="searchfield">accesslevel</span>: "' + curr.accesslevel + '",</br>';};
			if(curr.mediacount){mediacount = '<span class="searchfield">mediacount</span>: "' + curr.mediacount + '",</br>';};
			if(curr.groupcount){groupcount = '<span class="searchfield">groupcount</span>: "' + curr.groupcount + '",</br>';};
			if(curr.markscount){markscount = '<span class="searchfield">markscount</span>: "' + curr.markscount + '",</br>';};
			if(curr.relatedcount){relatedcount = '<span class="searchfield">relatedcount</span>: "' + curr.relatedcount + '",</br>';};
			if(curr.imagecount){imagecount = '<span class="searchfield">imagecount</span>: "' + curr.imagecount + '",</br>';};
			if(curr.peoplecount){peoplecount = '<span class="searchfield">peoplecount</span>: "' + curr.peoplecount + '",</br>';};
			if(curr.titlescount){titlescount = '<span class="searchfield">titlescount</span>: "' + curr.titlescount + '",</br>';};
			if(curr.datebegin){datebegin = '<span class="searchfield">datebegin</span>: "' + curr.datebegin + '",</br>';};
			if(curr.dateend){dateend = '<span class="searchfield">dateend</span>: "' + curr.dateend + '",</br>';};
			if(curr.contextualtextcount){contextualtextcount = 'contextualtextcount: "' + curr.contextualtextcount + '",</br>';};




			//p2: title,people,dated
			$(".metadata .p2 .phldr").html(
					title +
					people +
					dated +
					accessionyear
				);

			//p3: division,signed,century,classification
			$(".metadata .p3 .phldr").html(
					division +
					signed +
					century +
					culture +
					classification +
					description+
					provenance
				);

			//p4: department,objectnumber,contact,exhibitioncount,creditline,copyright
			$(".metadata .p4 .phldr").html(
					department +
					objectnumber +
					contact +
					exhibitioncount +
					creditline +
					copyright 
				);



			//p6: colorcount,worktypes,dimensions,medium,colors
			$(".metadata .p6 .phldr").html(
					colorcount +
					worktype+
					dimensions +
					medium +
					technique +
					colors
				);

			//p7: url,primaryimageurl,totalpageviews,totaluniquepageviews,lastupdate,dateoffirstpageview,dateoflastpageview,images
			$(".metadata .p7 .phldr").html(
					url +
					primaryimageurl +
					totalpageviews +
					totaluniquepageviews +
					lastupdate +
					dateoffirstpageview +
					dateoflastpageview +
					images
				);

			//p8: id,verificationlevel,imagepermissionlevel,accesslevel,mediacount,groupcount,markscount,relatedcount,imagecount,peoplecount,titlescount,datebegin,dateend,contextualtextcount
			$(".metadata .p8 .phldr").html(
					id +
					verificationlevel +
					verificationleveldescription +
					imagepermissionlevel +
					accesslevel +
					mediacount +
					groupcount +
					markscount +
					relatedcount +
					imagecount +
					peoplecount +
					titlescount +
					datebegin +
					dateend +
					contextualtextcount
				);

			$(".searchfield").css("color", color);
			$("#sort").html(sort+": "+curr[sort]); 
			$("#preview").animate({opacity: 1}, 500);
		} 
});
		




function customSort(a,b) {
	if ( a[sort] < b[sort] )
			return -1;
	if ( a[sort] > b[sort] )
			return 1;
	return 0;

}


function getMoreArt(count) {
	$.get("http://api.harvardartmuseums.org/object?gallery=any&apikey=f5473230-3f68-11e4-89b4-73adcea7266b&size=100&from="+count, function(data) {
		$.each(data.records, function(j, record) {
			if(record.primaryimageurl) art.records.push(record);
		});
		var next = count+100;
		if(7 > data.info.page) getMoreArt(next);
		else {
			sort = "medium";
			art.records.sort(customSort);
			populateMap();
		}
	});	
}
		
var color;
var day = dayofyear(new Date()) +1;

function dayofyear(d) {   // d is a Date object
	var yn = d.getFullYear();
	var mn = d.getMonth();
	var dn = d.getDate();
	var d1 = new Date(yn,0,1,12,0,0); // noon on Jan. 1
	var d2 = new Date(yn,mn,dn,12,0,0); // noon on input date
	var ddiff = Math.round((d2-d1)/864e5);
	return ddiff+1; 
}
		
$.get("http://api.harvardartmuseums.org/spectrum/"+day+"?apikey=f5473230-3f68-11e4-89b4-73adcea7266b", function(d) {
	color = d.color;
});
		
var w = window.innerWidth / 48;
var h = window.innerHeight / 30;
$("#highlight").width(w);
$("#highlight").height(h);
					
function populateMap() {
	ctx.clearRect(0,0,map.width,map.height);
	itemX = 48;
	var index=0;
	for(var j=0; j < 31; j++) {
		for(var i=0; i < 49; i++) {
			if(index  == art.records.length) return false;
			var x = i*w;
			var y = j*h;
			var t = index;
			addImage(t, x, y);	
			index++;
		}
	}
}





function addImage(order, x, y) {
	var base_image = new Image();
	base_image.src = "./art/" + art.records[order].objectid + ".jpg";
	base_image.addEventListener("load", function(){
		art.records[order].x1 = x;
		art.records[order].y1 = y;
		var sizeh = base_image.height;
		var sizew = (base_image.height/h)*w;
		if(sizew > base_image.width) {
			sizew = base_image.width;
			sizeh = (base_image.width/w)*h;
		} 
		
		if(base_image.height > base_image.width) size = base_image.width;
		ctx.drawImage(base_image, 0, 0, sizew, sizeh, x, y, w, h);		
		//base_image.removeEventListener("load");
		
	}		);
			
}


//////////////// TIMER AND USER ACTIVITY START ////////////////////////
$(window).load(function(){
var shuffle_time = 30000; ///TIME BETWEEN EACH RE-ORDERING
var inactive_time = 60000; ///TIME FOR STARTING/RESTARTING AFTER WINDOW-LOAD/USER-INACTIVE

var ordering_fields = [
	'title',
	'department',
	'classification',
	'medium',
	'technique'
	]
var timerorder = null;
function startshuffle(){
function shuffle(array) {
    var i = array.length,
        j = 0,
        temp;
    while (i--) {
        j = Math.floor(Math.random() * (i+1));
        // swap randomly chosen element with current element
        temp = array[i];
        array[i] = array[j];
        array[j] = temp;
    }
    return array;
}
i = -1;
var events = shuffle(ordering_fields);
(function eventpopups(){
	i = (i + 1) % events.length;
	var rand = events[i];
	console.log('order by: '+rand);


	///sort objects
	sort = rand;
	art.records.sort(customSort);
	populateMap();



    timerorder = setTimeout(eventpopups, shuffle_time);
})();
}
timerstart = setTimeout(startshuffle, inactive_time);


//ON MOUSE MOVE, RESTART ALL TIMERS/////
idleTime = 0;
$(document).mousemove(function( event ) {
//afterfirstmove();
idleTime = 0;
clearInterval(timerorder);
clearTimeout(timerstart);
timerstart = setTimeout(startshuffle, inactive_time);
console.log('set timers to zero!');
});

});





//////////////// TIMER AND USER ACTIVITY END ////////////////////////

	
	</script>
	</body>
</html>