<!DOCTYPE html>
<html>
	<head>

		<title>SANDBOX</title>
			
		<script type="text/javascript" src="lib/jquery-1.8.2.js" ></script>  
		<script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>
			<script src="lib/color-thief.js"></script>
	<style>
	
		body {
			background-color: #222;
		}
		
		
		#map {
				width: 100%;
				height:100%;
				position: relative;
				float: left;
				display: block;
		}
		
		.image {
			width: 27px;
			height: 27px;
			position: relative;
			float: left;
			background-size: cover;
		}
		
		#preview {
			position:absolute;
			margin-left: 20%;
			margin-right: 20%;		
			width:5px;
			height: 5px;
		}
		
		#preview.active {
			margin-top: 2%;
			width: 60%;
			height: 90%;
		}
		
		#preview img {
			max-width: 100%;
			max-height: 100%;
			display: block;
			margin: auto;
			position: absolute;
			top: 0;
			bottom: 0;
			left: 0;
			right: 0;
			webkit-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
			-moz-box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
			box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5)
		}
		
		.button {
			color: white;
			font-family: sans-serif;
			margin: auto;
			position: absolute;
			background-color: #222;
			display: block;
			padding: 5px;		
			position: absolute;
			left: 0px;
		}
		
		.button:hover {
			text-decoration: underline;
			cursor: pointer;

			
		}
	
	</style>
	</head>
	
	<body>
		<div id="map"></div>
		<div id="preview"></div>
	
	<script>
		var i = 0;
		var art = {};
		art.records = [];
		var curr = false;
		var host = window.location.host;
		var socket = io(host);
		var images2 = [];
		
		var galleries = ["1006", "1330", "1520", "2100", "2220", "2340", "2410", "2460", "2600", "4000"];

		getMoreArt(0);
		
		$("#preview").css("opacity", 0);
		
		$("#preview").on("click", function(e) {
			if($(e.target).hasClass("img-preview")) {
				$(this).animate({opacity: 0}, 500, function() {
					$(this).removeClass("active");
					$(this).empty();
					$("#map").css("opacity", 1);
					curr = false;
				});
			} else if($(e.target).hasClass("button")) {
				console.log(curr);
				socket.emit('add-item', {
					url: curr
				});
			}
		});
		
	
		socket.on('send-items', function(data) {
			console.log(data);
		});


		function getMoreArt(count) {
			$.get("http://api.harvardartmuseums.org/object?gallery=any&apikey=f5473230-3f68-11e4-89b4-73adcea7266b&size=100&from="+count, function(data) {
				console.log(data.info.totalrecords);
				$.each(data.records, function(j, record) {
					if(record.primaryimageurl) art.records.push(record);
					else console.log("no art");
				});
				var next = count+100;
				if(data.info.pages > data.info.page) window.setTimeout(getMoreArt(next), 500);
				else {
					//$("html").html(JSON.stringify(data));
					populateMap();
				}
			});	
		}
		
		function populateMap() {
			$.each(art.records, function(j, val) {
				var $div = $("<div class='image'></div>");
				$div.css("background-image", "url('"+val.primaryimageurl+"')");
				$div.attr("data-src", val.primaryimageurl);
				$div.attr("data-index", j);
				
				$("#map").append($div);
			});
			
			$(".image").on("click", function(e) {
				var $img = $("<img class = 'img-preview' src='"+$(this).attr("data-src")+"'><div class='button'>Add to tray</div>");
				curr = art.records[$(this).attr("data-index")];
				$("#preview").append($img);
				$("#map").css("opacity", .1);
				$("#preview").addClass("active");
				$("#preview").animate({opacity: 1}, 500, function() {
				
				});

			});
		}
		

	
	</script>
	</body>
</html>